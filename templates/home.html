<!-- templates/home.html -->
{% load bootstrap4 %}
{% load static %}
{% bootstrap_css %}
{% load users_tags %}

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">

        <title>Home</title>

        <link href="{% static 'css/base_home.css' %}" rel="stylesheet">
        <link href="{% static 'css/home.css' %}" rel="stylesheet">
        <link href="{% static 'css/tags_color.css' %}" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.0/css/mdb.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.8.1/css/all.min.css">
        <link rel="shortcut icon" href="{% static 'css/images/favicon.ico' %}">

        {% url 'home' as home %}
        {% url 'profile' as profile %}
        {% url 'match' as match %}
        {% url 'course_search' as courses %}
        {% url 'course_search_auto' as courses_auto %}
        {% url 'skill_search' as skill_search %}
	</head>

<body>
    <div id="wrap">
        <main>
        <div class="main" id = "home-page-app">
            <div class="col-12 mb-5" style = "width:100%; margin: 0 auto;" id="header-wrapper">
                <div id="navigation">
                        <nav class="navbar navbar-expand-md navbar-light font-weight-light" >
                            <a class="navbar-brand" href="{{ home }}" style="padding:0px 0px 3px 0px; font-size: 20px;">
                                <img src="{% static 'css/images/brand.png' %}" width="30" height="30" class="d-inline-block align-top" alt="">
                                Home
                            </a>
                            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".dual-collapse2" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                            <div class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2" id="navbarSupportedContent">
                                <ul class="topBotomBordersOut navbar-nav mr-autox">
                                <li class="nav-item {% active request skill_search %}">
                                    <a class="nav-link" href="{{ skill_search }}">Tags</a>
                                </li>
                                </ul>
                            </div>
                        
                            <div class="navbar-collapse collapse w-100 order-2 dual-collapse2">
                                <ul class="navbar-nav ml-auto">
                                {% if request.user.is_authenticated %}
                                    <nav-list-comp
                                    v-bind:following="following"
                                    v-bind:request_user="request_user"
                                    @update-following-list="update_following_list"
                                    ></nav-list-comp>
                                {% endif %}
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true">
                                    {% if user.is_authenticated %}
                                        {{request.user.username}}
                                    {% else%}
                                        Sign In
                                    {% endif %}
                                    </a>
                                    <div class="dropdown-menu w-100 order-4 dropdown-menu-right" aria-labelledby="navbarDropdown">
                                    {% if request.user.is_authenticated %}
                                    <a class="dropdown-item" href="{% url 'profile' request.user.username %}">Profile</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="{% url 'update_profile' request.user.username %}">Edit Profile</a>
                                    <a class="dropdown-item" href="{% url 'logout'%}">Log out</a>
                                    {% else %}
                                    <a class="dropdown-item" href="{% url 'login' %}">Sign in</a>
                                    {% endif %}
                                    </div>
                                </li>
                                </ul>
                            </div>
                        </nav>
                </div>
                <div class="container mt-5 mb-1 text-center">
                    <h1 class="main-title">MSN Mentor-Mentee Match</h1>
                </div>
                <div class="tag mb-3" style="width:100%;">
                    <search-tag-comp 
                    v-bind:checkbox_on="checkbox_on"
                    v-bind:request_user="request_user" 
                    @update-user-list="update_user_list"></search-tag-comp>
                </div>
            </div>
            <div class="user-list-div">
                <div style="margin: 0px 0px 35px 0px;">
                    <h3 class="line-break"><span>Hoo's My Match</span></h3>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-10 col-lg-10 col-xs-offset-0 col-sm-offset-0 mb-5" style="width:100%; margin: 0 auto;">
                    <user-list-comp 
                        v-bind:all_users="all_users"
                        v-bind:request_user="request_user"
                        v-bind:following="following"
                        @update-following-list="update_following_list"
                        ></user-list-comp>
                </div>
            </div>
        </div>
        </main>
    </div>
    <footer>
        <section id="footer">
            <div class="container">
            <div class="row text-center text-xs-center text-sm-left text-md-left">
                <div class="col-xs-12 col-sm-6 col-md-4">
                    <h5 style="font-weight: 400;">Quick links</h5>
                    <ul class="list-unstyled quick-links">
                    <li><a href="{% url 'home' %}"><i class="fa fa-angle-double-right"></i>Home</a></li>
                    {% if user.is_authenticated %}
                        <li><a href="{% url 'skill_search' %}"><i class="fa fa-angle-double-right"></i>Tags</a></li>
                        <li><a href="{% url 'profile' request.user.username %}"><i class="fa fa-angle-double-right"></i>Profile</a></li>
                    {% endif %}
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-6 col-md-6">
                <h5 style="font-weight: 400;">Get In Touch</h5>
                <ul class="list-unstyled quick-links">
                    <li><span><i class="fa fa-angle-double-right"></i>Mentor Program Chair WeChat ID: zgt19991026</span></li>
                    <li><span><i class="fa fa-angle-double-right"></i>Email: <a href="mailto:msnatuva@gmail.com">msnatuva@gmail.com</a></span></li>
                </ul>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12 mt-2 mt-sm-2 text-center text-white">
                <p class="h6">&copy <a class="text-green ml-2" href="https://www.msnatuva.org" target="_blank">2019 Mainland Student Network.</a> All Rights Reserved.</p>
                </div>
                </hr>
            </div>	
            </div>
        </section>
    </footer>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.0/js/mdb.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/axios@0.18.0/dist/axios.js"></script>

    <script>
        Vue.component('user-list-comp', {
            props:["all_users","request_user","following",],
            template: `
            <div>
                <div class="card-columns" id="users_container">
                    <div class="card user-card" v-if="user.role != '' " v-for="user in all_users">
                        <div class="user-card-inner">
                            <div id="show-modal" @click="openModal(user, user.skills)">
                                <progressive-img v-if="user.picture" 
                                    :src="user.picture" 
                                    :placeholder="user.avatar"
                                    :blur="10"
                                    />
                            </div>
                            <div class="card-body">
                                <div class="title d-flex w-100 justify-content-between">
                                    <h5 class="mb-1 font-weight-bold">
                                        \{\{user.first_name\}\} \{\{user.last_name\}\}
                                    </h5>
                                    <small style="float:right;">\{\{ user.year \}\}</small>
                                </div>
                                <div class="title d-flex w-100 justify-content-between">
                                    <small v-if="user.major" class="text-muted">Major: \{\{ user.major \}\}</small>
                                </div>
                                <div class="user-id-tags">
                                    <span v-if="user.role" class="user-id-tag" :class="user.role">\{\{ user.role \}\}</span>
                                    <span v-if="user.follow" class="user-id-tag fav-user">Like</span>
                                </div>
                                <small v-if="user.score && user.score > 0" class="score-text">Similarity: \{\{ user.score \}\}%</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal fade" id="userProfileModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">\{\{modal_user.first_name\}\} \{\{modal_user.last_name\}\}</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <img :src="modal_user.picture" class="card-img-top" alt="None">
                            <div class="skill-tags">
                                <template v-for="(skills_of_type, skills_type_name) in modal_skills">
                                    <a v-for="skill in skills_of_type"
                                        class="skill-tag"
                                        :href="skill.skill_url"
                                        v-bind:class="skill.skill_type">
                                        <span>\{\{skill.skill_name\}\}</span>
                                    </a>
                                </template>
                            </div>
                                <table class="table table-user-information">
                                    <tbody>
                                        <tr>
                                            <td class="field-title">Email</td>
                                            <td>\{\{modal_user.email\}\}</td>
                                        </tr>
                                        <tr>
                                            <td class="field-title">Year</td>
                                            <td>\{\{modal_user.year\}\}</td>
                                        </tr>
                                        <tr v-if="modal_user.major">
                                            <td class="field-title">Major</td>
                                            <td>\{\{modal_user.major\}\}</td>
                                        </tr>
                                        <tr v-if="modal_user.major_two">
                                            <td class="field-title">Second Major</td>
                                            <td>\{\{modal_user.major_two\}\}</td>
                                        </tr>
                                        <tr v-if="modal_user.minor">
                                            <td class="field-title">Minor</td>
                                            <td>\{\{modal_user.minor\}\}</td>
                                        </tr>
                                        <tr v-if="modal_user.role">
                                            <td class="field-title">Role</td>
                                            <td>\{\{modal_user.role\}\}</td>
                                        </tr>
                                        <tr v-if="modal_user.wechat">
                                            <td class="field-title">WeChat ID</td>
                                            <td>\{\{modal_user.wechat\}\}</td>
                                        </tr>
                                        <tr v-if="modal_user.birth_date">
                                            <td class="field-title">Birth Date</td>
                                            <td>\{\{modal_user.birth_date\}\}</td>
                                        </tr>
                                        <tr v-if="modal_user.sex">
                                            <td class="field-title">Gender</td>
                                            <td>\{\{modal_user.sex\}\}</td>
                                        </tr>
                                        <tr v-if="modal_user.location">
                                            <td class="field-title">Location</td>
                                            <td>\{\{modal_user.location\}\}</td>
                                        </tr>
                                        <tr v-if="modal_user.bio">
                                            <td class="field-title">Bio</td>
                                            <td>\{\{modal_user.bio\}\}</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div v-if="modal_user.video.length">
                                    <video width="100%" controls :src="modal_user.video">
                                        Your Browser does not support video tags lol
                                    </video>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" id="follow-btn" v-if="request_user.role != '' 
                                && modal_user.role != ''
                                && !modal_user.follow 
                                && modal_user.role != request_user.role 
                                && request_user.pk != modal_user.pk " 
                                class="btn btn-Primary" @click.stop="addToFav(modal_user)"
                                >Add to Favorite</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            `,
            data: function () {
                return {          
                tags: [],
                on_off: 1,
                flw_limit : 3,
                modal_user: {
                    "pk": "",
                    "user_url": "",
                    "picture": "",
                    "first_name": "",
                    "last_name": "",
                    "email": "",
                    "bio": "",
                    "birth_date": "",
                    "location": "",
                    "year": "",
                    "major": "",
                    "skills":"",
                    "video":"",
                },
                modal_skills: null,
                }
            },
            methods:{
                openModal(user, user_skills){
                    this.modal_user = user;
                    // console.log("all_skill_names", user_skills);
                    this.modal_skills = user_skills;
                    $('#userProfileModal').modal('show');
                },
                addToFav(user){
                    if (this.following.length >= this.flw_limit){
                            $('#follow-btn').popover({
                                    trigger: 'focus',
                                    placement: 'top',
                                    container: 'body',
                                    html: true,
                                    content: "Don't be too 花心 <br /> You can only like 3 users",
                                });
                            $('#follow-btn').popover('show')
                        }
                    else{
                        $('#follow-btn').popover('disable')
                        axios.get('/skills/ajax/add_to_list/',{params: {user_pk:user.pk}}).then(response => {
                            $('#userProfileModal').modal('hide');
                            var tmp_fav = {
                                "pk": user.pk,
                                "user_url": "/users/"+user.username+"/",
                                "first_name": user.first_name,
                                "last_name": user.last_name,
                            }
                            this.$emit('update-following-list', tmp_fav ,1); 
                        });
                    }
                },
                
            },
            mounted(){
                
            },
            })

        Vue.component('search-tag-comp', {
            props:['request_user','checkbox_on'],
            template: `
            <div>
                <div class="search-tags mb-3">
                    <span v-for="tag in tags"
                        class="search-tag">
                        <span>\{\{tag\}\}</span>
                        <span class="search-tag-remove"><i v-on:click="del_tag(tag)" class="fas fa-times"></i></span>
                    </span>
                </div>
                <div>
                    <div class="search-form mt-1">
                        <div class="search-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <input @keydown="onKeydown" v-model="searchquery" autocomplete="off" id="myInput" type="text" name="class" placeholder=" &quot;Basketball&quot;, &quot;major:Econ&quot;, &quot;birth:2001&quot; " class=" search-input" aria-label="Search">
                    </div>
                    <div v-if="checkbox_on" class="d-flex checkbox-div">
                        <div class="custom-control custom-checkbox checkboxx">
                            <input type="checkbox" class="custom-control-input" id="mentor" value="role:Mentor" v-model="tags">
                            <label class="custom-control-label role-label" for="mentor">Mentor</label>
                        </div>
                        <div class="custom-control custom-checkbox checkboxx">
                            <input type="checkbox" class="custom-control-input" id="mentee" value="role:Mentee" v-model="tags">
                            <label class="custom-control-label role-label" for="mentee">Mentee</label>
                        </div>
                    </div>
                </div>
                <div class="all-buttons">
                        <button @click="getUsersBySim" class="btn btn-show-me">Best Match</button>
                        <button v-if="request_user.role == '' " @click="openModal('Mentor')" class="btn btn-show-me">Be A Mentor</button>
                        <button v-if="request_user.role == '' " @click="openModal('Mentee')" class="btn btn-show-me">Be A Mentee</button>
                </div>
                <div v-if="request_user.role == '' " class=" mt-3 text-center">
                    <small class="text-muted">*Note that you have to be a mentor/mentee to appear in the user list and perform any actions</small>
                </div>

                <div class="modal fade" id="modal_role" tabindex="-1" role="dialog" aria-labelledby="match_request" aria-hidden="true">
                    <form method="post">
                        {% csrf_token %}
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header text-center">
                                    <h4 class="modal-title">\{\{modal_role\}\}</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p class="role-confirm-text">Do you really want to be a <strong>\{\{modal_role\}\}</strong>?</p>
                                    <small class="text-muted">*Note that your role can only be changed by the mentor program chair once you've made your choice.</small>
                                </div>
                                <div class="modal-footer">
                                    <input type="submit" class="btn btn-primary" :name="modal_role" value="Yes">
                                    <input type="button" class="btn btn-danger" data-dismiss="modal" value="No">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
            `,
            data: function () {
                return {
                searchquery: '',
                tags: [],
                modal_role:'',
                }
            },
            watch:{
                tags:function (tag){
                    axios.get('/skills/ajax/retrieve_users/',{params: {all_tags: this.tags.join('`'),}}).then(response => {
                        this.$emit('update-user-list', response.data.all_users);
                    });
                }
            },
            methods:{
                add_tag(tag){
                    this.tags.push(tag);
                },
                del_tag(tag){
                    this.tags.splice(this.tags.indexOf(tag), 1);
                    // axios.get('/skills/ajax/retrieve_users/',{params: {all_tags: this.tags.join('`'),}}).then(response => {
                    //     this.$emit('update-user-list', response.data.all_users);
                    // });
                },
                onKeydown(e) {
                    if(e.keyCode == 13 && this.searchquery.length > 1){
                        this.add_tag(this.searchquery);
                        this.searchquery = ""
                    }
                },
                getUsersBySim(e){
                    axios.get('/skills/ajax/get_users_by_sim/',{params: {all_tags: this.tags.join('`'),}}).then(response => {
                        this.$emit('update-user-list', response.data.all_users);
                    });
                },
                openModal(role){
                    this.modal_role = role;
                    $('#modal_role').modal('show');
                },
            },
            mounted(){
                
            },
            })

        Vue.component('nav-list-comp', {
            props:["following",],
            template: `
            <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" @click="" role="button" data-toggle="dropdown" aria-haspopup="true">
                Favorites
            </a>
            <div class="dropdown-menu dropdown-menu-right " @click.stop="" aria-labelledby="navbarDropdown">
                {% if request.user.is_authenticated %}
                <span class="dropdown-item" v-if="following.length == 0">No Favorite Users</span>
                <div class="dropdown-item d-flex w-100 justify-content-between" v-for="following_user in following">
                    <a :href="following_user.user_url"><span>\{\{ following_user.first_name \}\} \{\{ following_user.last_name \}\}</span></a>
                    <span style="padding:12px 4px 8px 4px" @click="del_fav(following_user)"><i class="fas fa-trash-alt"></i></span>
                </div>
                {% else %}
                <a class="dropdown-item" href="{% url 'login' %}">Sign in</a>
                {% endif %}
            </div>
            </li>
            `,
            data: function () {
                return {
                on_off:0,
                }
            },
            methods:{
                del_fav(following_user){
                axios.get('/skills/ajax/del_fav/',{params: {user_pk:following_user.pk}}).then(response => {
                    $('#follow-btn').popover('hide')
                    $('#follow-btn').popover('disable')
                    this.$emit("update-following-list",following_user, 0);
                });
                },
                
            },
            mounted(){
            },
        })

        const is = function (value) {
            return typeof value !== 'undefined' && value !== null
        }

        var image = {
            props: {
                src: { type: null, required: true },
                placeholder: { type: String },
                blur: { type: Number },
                aspectRatio: { type: Number },
                noRatio: { type: Boolean },
                fallback: { type: String },
                alt: { type: String },
                customClass: { type: String }
            },

            data () {
                return {
                isRendered: false,
                options: { cache: true },
                defaultBlur: 20,
                image: null,
                originalWidth: 0,
                placeholderImage: null,
                aspectRatioDetect: 0.5625,
                isPollingKilled: false,
                isImageCached: false,
                imageError: false
                }
            },

            watch: {
                src () {
                this.handleImageLoading()
                }
            },

            computed: {
                shouldPlaceholderRender () {
                return !!this.placeholderImage
                },

                shouldImageRender () {
                return this.isRendered
                },

                cached () {
                return this.options.cache && this.isImageCached
                },

                calculatedRatio () {
                return this.aspectRatio || this.aspectRatioDetect
                },

                wrapperStyle () {
                if (this.noRatio) {
                    return {}
                }

                return {
                    paddingBottom: `${this.calculatedRatio * 100}%`
                }
                },

                componentStyle () {
                return {
                    maxWidth: this.originalWidth === 0 ? '100%' : `${this.originalWidth}px`
                }
                },

                blurStyle () {
                let blur = this.defaultBlur

                if (is(this.blur)) {
                    return this.getBlurStyle(this.blur)
                }

                if (is(this.options.blur)) {
                    return this.getBlurStyle(this.options.blur)
                }

                return this.getBlurStyle(blur)
                }
            },

            mounted () {
                this.handleImageLoading()
            },

            methods: {
                getBlurStyle (amount) {
                if (amount === 0) {
                    return
                }

                return {
                    filter: `blur(${amount}px)`
                }
                },

                defineAspectRatio (img) {
                const delay = this.options.timeout || 2500
                const pollInterval = this.options.pollInterval || 10

                const poll = setInterval(() => {
                    if (!img.naturalWidth) {
                    return
                    }

                    clearInterval(poll)

                    const { naturalHeight, naturalWidth } = img

                    this.aspectRatioDetect = naturalHeight / naturalWidth
                    this.originalWidth = naturalWidth
                }, pollInterval)

                setTimeout(() => {
                    if (img.naturalWidth) {
                    return
                    }

                    clearInterval(poll)
                    this.isPollingKilled = true
                }, delay)
                },

                isCached (src) {
                const image = new Image()

                image.src = src

                return image.complete
                },

                loadImage () {
                const image = new Image()
                const delay = this.options.delay || 0
                const fallbackSrc = this.fallback || this.options.fallback
                const imageSource = this.imageError ? fallbackSrc : this.src

                if (this.options.cache && this.isCached(imageSource)) {
                    this.image = imageSource
                    this.placeholderImage = null
                    this.isImageCached = true
                } else {
                    // reset the image holder
                    this.image = null
                    this.isImageCached = false
                    this.isRendered = false
                }

                if (!this.aspectRatio) {
                    this.defineAspectRatio(image)
                }

                image.onload = () => {
                    if (this.image) {
                    return
                    }

                    if (this.isPollingKilled && !this.aspectRatio) {
                    this.defineAspectRatio(image)
                    }

                    // assign the image
                    this.image = imageSource

                    let ctx
                    try {
                    // the drawImage it's a synchronous method, so when it's done
                    // the nextTick will notify the view that we're ready
                    // to fadeIn the main image
                    ctx = this.$refs.canvas.getContext('2d')
                    ctx.drawImage(this.$refs.main, 0, 0)
                    } catch (e) {
                    // see https://github.com/MatteoGabriele/vue-progressive-image/issues/30
                    }

                    // next tick to know when the image is rendered
                    this.$nextTick(() => {
                    // timeout for a custom delay
                    setTimeout(() => {
                        this.isRendered = true
                        // remove placeholder image
                        this.placeholderImage = null
                    }, delay)
                    })

                    this.imageError = false

                    this.$emit('onLoad', image.src)
                }

                image.onerror = error => {
                    this.$emit('onError', error)

                    if (process.env.NODE_ENV !== 'production' && !this.fallback) {
                    console.warn('[vue-progressive-image] An error occured during the image loading')
                    }

                    if (this.fallback || this.options.fallback) {
                    this.imageError = true
                    this.handleImageLoading()
                    }
                }

                image.src = imageSource
                },

                loadPlaceholder () {
                if (!this.placeholder && !this.options.placeholder) {
                    return
                }

                const image = new Image()
                const src = this.placeholder || this.options.placeholder

                image.src = src

                image.onload = () => {
                    this.placeholderImage = src

                    // Dispatches an event on placeholder image load
                    this.$emit('onLoadPlaceholder', src)
                }

                image.onerror = error => {
                    this.$emit('onPlaceholderError', error)

                    if (process.env.NODE_ENV !== 'production') {
                    console.warn('[vue-progressive-image] An error occured during the placeholder image loading')
                    }
                }
                },

                handleImageLoading () {
                this.loadPlaceholder()
                this.loadImage()
                }
            }

        }


        Vue.component('progressive-img',{
            props: {
            imageCustomClass: { type: String }
            },
            template:`
            <div ref="image" :class="['progressive-image', customClass]" :style="componentStyle">
                <div
                v-if="cached"
                class="progressive-image-wrapper"
                :style="wrapperStyle">
                <img
                    :class="['progressive-image-main', imageCustomClass]"
                    :src="image"
                    :alt="alt"
                />
                </div>
                <span v-else>
                <canvas
                    v-if="!shouldImageRender"
                    width="1"
                    height="1"
                    class="progressive-image-canvas"
                    ref="canvas">
                </canvas>
                <div class="progressive-image-wrapper" :style="wrapperStyle">
                    <transition
                    enter-class="progressive-image-enter"
                    enter-active-class="progressive-image-before-enter">
                    <img
                        v-show="shouldImageRender"
                        :class="['progressive-image-main', imageCustomClass]"
                        ref="main"
                        :src="image"
                        :alt="alt"
                    />
                    </transition>
                    <transition
                    enter-class="progressive-image-enter"
                    enter-active-class="progressive-image-before-enter">
                    <div
                        v-if="shouldPlaceholderRender"
                        class="progressive-image-placeholder"
                        :class="{ 'progressive-image-placeholder-out': shouldImageRender }"
                        :style="placeholderStyle">
                    </div>
                    </transition>
                </div>
                </span>
            </div>
            `,
            mixins: [
                image
            ],
            computed: {
                placeholderStyle () {
                    return {
                    ...this.blurStyle,
                    'background-image': `url(${this.placeholder || this.options.placeholder})`
                    }
                }
            }

        })



        var home_page_app = new Vue({
            el: "#home-page-app",
            data: {
                all_users:[],
                following:[],
                checkbox_on: 0,
                request_user:{
                    "username":"{{request.user.username}}",
                    "pk":"{{request.user.pk}}",
                    "role":"{{request.user.profile.role}}",
                },
            },
            methods:{
                update_user_list(new_users){
                    this.all_users = new_users; 
                },
                update_following_list(following_user, add_del){
                    if(add_del == 1){
                        this.following.push(following_user)
                        this.all_users.filter(function(item) { return item.pk === following_user.pk; })[0].follow = true;
                    }
                    else if(add_del == 0){
                        this.following.splice(this.following.indexOf(following_user), 1);
                        this.all_users.filter(function(item) { return item.pk === following_user.pk; })[0].follow = false;
                    }
                },
            },
            mounted(){
                axios.get('/skills/ajax/get_all_users/',{params: {}}).then(response => {
                    // console.log(response.data.all_users);
                    this.all_users = response.data.all_users;
                    this.checkbox_on = 1
                });

                axios.get('/skills/ajax/get_follow_list/',{params: {}}).then(response => {
                    // console.log("get update users", response.data.following);
                    this.following = response.data.following;
                });
            },
        })


    
    </script>
</body>

</html>