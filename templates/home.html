<!-- templates/home.html -->
{% extends 'base.html' %}
{% load bootstrap4 %}
{% load staticfiles %}
{% bootstrap_css %}

{% block title %}Home{% endblock %}

{% block css %}
<link href="{% static 'css/home.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>

<div class="col-12 mb-5" style = "width:100%; margin: 0 auto;">
	<div class="container mt-5 mb-4 text-center">
		<h1 style="font-size:65px">Welcome to ?????????</h1>
		<h5>Search and match with hundreds of students</h5>
	</div>
</div>

<div id = "home-page-app">

    <div class="col-xs-12 col-sm-12 col-md-10 col-lg-8 col-xs-offset-0 col-sm-offset-0 mb-5" style="width:100%; margin: 0 auto;">
        <user-list-comp></user-list-comp>
    </div>
</div>

<script>
    Vue.component('user-list-comp', {
        template: `
        <div>
            <div class="tag mb-5" style="width:100%;">
                <search-tag-comp @updateUserList="update_user_list"></search-tag-comp>
            </div>
            <div class="card-columns" id="users_container">
                <div class="card user-card" v-for="user in all_users">
                    <div class="user-card-inner">
                    <a :href="user.user_url">
                    <img v-if="user.picture" :src="user.picture" class="card-img-top" alt="None">
                    <img v-else src="" class="card-img-top" alt="None">
                    </a>
                    <div class="card-body">
                        <div class="title d-flex w-100 justify-content-between">
                            <h5 class="mb-1 font-weight-bold">
                                \{\{user.first_name\}\} \{\{user.last_name\}\}
                            </h5>
                            <small style="float:right;">\{\{ user.year \}\}</small>
                        </div>
                        <small v-if="user.major" class="text-muted">Major: \{\{ user.major \}\}</small>
                    </div>
                    </div>
                </div>
            </div>
        </div>
        `,
        data: function () {
            return {
            all_users: [],
            tags: [],
            }
        },
        methods:{
            update_user_list(new_users){
                console.log("update_user_list", new_users);
                this.all_users = new_users; 
            },
            
        },
        mounted(){
            axios.get('/skills/ajax/get_all_users/',{params: {}}).then(response => {
                console.log(response.data.all_users);
                this.all_users = response.data.all_users;
            });
        },
        })

    Vue.component('search-tag-comp', {
        template: `
        <div>
            <div class="search-tags">
                <span v-for="tag in tags"
                    class="search-tag">
                    <span>\{\{tag\}\}</span>
                    <span class="search-tag-remove"><i v-on:click="del_tag(tag)" class="fas fa-times"></i></span>
                </span>
            </div>
            <input @keydown="onKeydown" v-model="searchquery" autocomplete="off" id="myInput" type="text" name="class" placeholder="Add a filter tag" class="form-control mr-sm-2" aria-label="Search">
        </div>
        `,
        data: function () {
            return {
            searchquery: '',
            tags: [],
            }
        },
        methods:{
            add_tag(tag){
                this.tags.push(tag);
                console.log("all_tags", this.tags);
                axios.get('/skills/ajax/retrieve_users/',{params: {all_tags: this.tags.join('`'),}}).then(response => {
                    console.log("get update users", response.data.all_users)
                    this.$emit('updateUserList', response.data.all_users);
                });
                
            },
            del_tag(tag){
                this.tags.splice(this.tags.indexOf(tag), 1);
                axios.get('/skills/ajax/retrieve_users/',{params: {all_tags: this.tags.join('`'),}}).then(response => {
                    console.log("get update users", response.data.all_users)
                    this.$emit('updateUserList', response.data.all_users);
                });
            },
            onKeydown(e) {
                if(e.keyCode == 13 && this.searchquery.length > 1){
                    this.add_tag(this.searchquery);
                    this.searchquery = "";
                    // axios.get('/skills/ajax/add_del_skill/',{params: {skill_pk: skill.skill_pk, add_del:"del"}}).then(response => {
                    
                    // });
                }
            },
        },
        mounted(){
            
        },
        })
        
    var home_page_app = new Vue({
        el: "#home-page-app",
    })
</script>
{% endblock %}
